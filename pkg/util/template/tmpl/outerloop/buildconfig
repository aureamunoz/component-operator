apiVersion: v1
kind: BuildConfig
metadata:
  labels:
    app: {{.Name}}{{ range $key, $value := .ObjectMeta.Labels }}
    {{ $key }}: {{ $value }}{{ end }}
  name: {{.Name}}
spec:
  output:
    to:
      kind: ImageStreamTag
      name: {{.Name}}:latest
  source:
    git:
      uri: ${SOURCE_REPOSITORY_URL}
      ref: ${SOURCE_REPOSITORY_REF}
    type: Git
  strategy:
    sourceStrategy:
      from:
        kind: ImageStreamTag
        name: {{.Spec.RuntimeName}}:latest
      incremental: true
      env:
      - name: MAVEN_ARGS_APPEND
        value: "-pl ."
      - name: ARTIFACT_DIR
        value: "./target"
      - name: ARTIFACT_COPY_ARGS
        value: "*-exec.jar"
    type: Source
  triggers:
  - github:
      secret: GITHUB_WEBHOOK_SECRET
    type: GitHub
  - type: ConfigChange
  - imageChange: {}
    type: ImageChange